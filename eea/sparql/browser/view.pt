<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
  lang="en-US"
  metal:use-macro="here/main_template/macros/master"
  i18n:domain="eea">



<metal:css fill-slot="css_slot">
    <style type="text/css" media="all"
        tal:content="string: @import url(${context/absolute_url}/++resource++sparql.css);"></style>
</metal:css>

<body>
<div metal:fill-slot="content-core"  tal:define="options view/test_query">
    <metal:versions use-macro="here/portlet_versions/macros/versions">
        <metal:old fill-slot="old" />
    </metal:versions>

    <label>JSON Url:</label>
    <br/>
    <a tal:attributes="href string:${context/absolute_url}/@@daviz-view.json" 
       tal:content="string:${context/absolute_url}/@@daviz-view.json">link</a>

    <br/>
    <br/>
    <label>Endpoint:</label>
    <br/>
    <span tal:content="context/endpoint_url">endpoint</span>

    <br/>
    <br/>
    <label>Query:</label>
    <!--br/>
    <blockquote class="sparql-query"
            tal:content="context/query"/-->


    <form tal:condition="options/arg_spec"
          name="method-arguments" method="get">
      <table>
        <tr tal:repeat="arg options/arg_spec">
          <td class="form-label" tal:content="arg"/>
          <td tal:define="input_name python:'%s:utf8:ustring' % (arg,)">
            <input size="50"
                   tal:define="prev_value python:request.form.get(arg)"
                   tal:attributes="name input_name; value prev_value"/>
          </td>
        </tr>
        <tr><td colspan="2"><input type="submit" value="Execute"/></td></tr>
      </table>
    </form>

    <blockquote class="sparql-query"
            tal:condition="options/query|nothing"
            tal:content="structure options/query"/>

    
    <h3>Data preview</h3>
    
    <p class="sparql-stats" tal:condition="options/data">
      Received
      <span class="number" tal:content="python:len(options['data']['rows'])"/>
      rows<tal:block condition="python:'duration' in options"> in
      <span class="number" tal:content="python:'%.3f' % options['duration']"/>
      seconds</tal:block>.
    </p>
    
    <table class="sparql-results" tal:condition="options/data">
      <thead>
        <tr>
          <th tal:repeat="name options/data/var_names"
              tal:content="name"/>
        </tr>
      </thead>
      <tbody>
        <tr tal:repeat="row python: options['data']['rows'][:10]" tal:attributes="class string:row_${repeat/row/index}">
          <td tal:repeat="value row"
              tal:content="value/n3|string:&quot;${value}&quot;"/>
        </tr>
      </tbody>
    </table>

    <p class="sparql-has-result"
       tal:define="has_result options/data/has_result|nothing"
       tal:condition="python: has_result is not None">
      Query
      <span class="boolean">will<tal:block condition="not:has_result">
        not</tal:block></span>
      return a result.
    </p>

    <blockquote class="sparql-error"
            tal:condition="options/error|nothing"
            tal:content="options/error"/>

    <br/>
    <h3>Downloads</h3>
    <br/>
    <a tal:attributes="href string:${context/absolute_url}/@@sparql-download?format=json">
        JSON
    </a>
    <br/>
    <a tal:attributes="href string:${context/absolute_url}/@@sparql-download?format=exhibit">
        Exhibit JSON
    </a>
    <br/>
    <a tal:attributes="href string:${context/absolute_url}/@@sparql-download?format=html">
        HTML
    </a>
    <br/>
    <a tal:attributes="href string:${context/absolute_url}/@@sparql-download?format=xml">
        XML
    </a>
    <br/>
    <a tal:attributes="href string:${context/absolute_url}/@@sparql-download?format=xml_with_schema">
        XML with Schema
    </a>
    <br/>
    <a tal:attributes="href string:${context/absolute_url}/@@sparql-download?format=csv">
        CSV
    </a>
    <br/>
    <a tal:attributes="href string:${context/absolute_url}/@@sparql-download?format=tsv">
        TSV
    </a>
    <br/>

    <metal:versions use-macro="here/portlet_versions/macros/versions">
        <metal:new fill-slot="new" />
    </metal:versions>

</div>
</body>
</html>
